const axios = require('axios');

module.exports = {
  config: {
    name: "bot",
    credits: "Emon",
    prefix: "auto",
    permission: 0,
    aliases: ["bot", "baby", "babu"],
    description: "Chat With bot",
    tags: ["General"],
  },
  start: async ({ event, api, botInfo }) => {
    const lastReplies = {};
    
    const botId = botInfo.id;
    let isReplyEnabled = true; 
    const text = event.body;
    const chatId = event.msg.chat.id;

    const greetings = [
      "à¦•à¦¿ à¦–à¦¬à¦° à¦°à§‡ à¦¹à¦¿à¦°à§‹? ðŸ•¶ï¸",
      "à¦¬à¦¸ à¦¡à§‡à¦•à§‡à¦›à§‡à¦¨, à¦¹à¦¾à¦œà¦¿à¦° à¦†à¦®à¦¿! ðŸ¤–",
      "à¦†à¦®à¦¾à¦•à§‡ à¦¡à¦¾à¦•à¦¾à¦° à¦²à¦¾à¦‡à¦¸à§‡à¦¨à§à¦¸ à¦†à¦›à§‡ à¦¤à§‹? ðŸš”ðŸ˜‚",
      "à¦à¦¤ à¦¡à¦¾à¦•à¦¾à¦¡à¦¾à¦•à¦¿ à¦•à¦°à¦¿à¦¸ à¦¨à¦¾, à¦šà¦¾à¦°à§à¦œ à¦¶à§‡à¦· à¦¹à§Ÿà§‡ à¦¯à¦¾à¦¬à§‡ ðŸ”‹ðŸ¤£",
      "à¦à¦‡ à¦¯à§‡ à¦¬à¦¸, à¦–à¦¾à¦‡à¦›à¦¿ à¦¬à§à¦à¦¿ à¦†à¦œ à¦•à¦¾à¦¬à¦¾à¦¬? ðŸ¢",
      "à¦¤à§à¦‡ à¦¡à¦¾à¦•à¦›à¦¿à¦¸ à¦®à¦¾à¦¨à§‡ à¦•à¦¿à¦›à§ à¦—à¦¨à§à¦¡à¦—à§‹à¦² à¦†à¦›à§‡ à¦¨à¦¿à¦¶à§à¦šà¦¿à¦¤ ðŸ˜",
      "à¦†à¦®à¦¾à¦•à§‡ à¦¨à¦¾ à¦¡à§‡à¦•à§‡ à¦à¦•à¦¬à¦¾à¦° à¦¬à¦¿à¦°à¦¿à§Ÿà¦¾à¦¨à¦¿ à¦–à¦¾à¦“à§Ÿà¦¾à¦‡à¦¸! ðŸ—",
      "à¦¹à¦¾à¦œà¦¿à¦° à¦†à¦›à¦¿, à¦¬à¦² à¦•à§€ à¦šà¦¾à¦¸! ðŸ˜Ž",
      "à¦“à¦‡ à¦¥à¦¾à¦®! à¦†à¦®à¦¿ à¦†à¦¸à¦›à¦¿ ðŸš€",
      "à¦¡à§‡à¦•à§‡à¦›à¦¿à¦¸, à¦¹à¦¾à¦œà¦¿à¦° à¦¹à¦‡à¦²à¦¾à¦®! ðŸ“ž",
      "à¦­à¦¾à¦‡à¦°à§‡, à¦†à¦®à¦¾à¦°à§‡ à¦¡à¦¾à¦•à¦²à¦¿ à¦•à§à¦¯à¦¾à¦¨? ðŸ˜…",
      "à¦¡à¦¾à¦• à¦¦à¦¿à¦²à¦¿ à¦¤à§‹, à¦à¦–à¦¨ à¦šà¦¾à¦‡à¦²à§‡ à¦¨à¦¾à¦šà¦¿à¦“ ðŸ˜œ",
      "à¦à¦¤à¦¬à¦¾à¦° à¦¡à¦¾à¦•à¦¿à¦¸ à¦•à§à¦¯à¦¾à¦¨? à¦†à¦®à¦¿ à¦•à¦¿ à¦ªà§à¦°à§‡à¦®à¦¿à¦•à¦¾ à¦¨à¦¾à¦•à¦¿? ðŸ’”ðŸ˜‚",
      "à¦†à¦œà¦•à§‡à¦‡ à¦¤à§‹ à¦¡à§‡à¦•à§‡à¦›à¦¿à¦¸ à§§à§¦ à¦¬à¦¾à¦°! ðŸ˜¡",
      "à¦à¦•à¦Ÿà§ à¦¶à¦¾à¦¨à§à¦¤à¦¿ à¦¦à¦¿à¦¬à¦¿ à¦¨à¦¾? ðŸ¤¯",
      "à¦•à¦¿ à¦•à¦°à¦¿à¦¸? à¦–à¦¾à¦‡à¦›à¦¿à¦¸ à¦•à¦¿à¦›à§? ðŸ›",
      "à¦¤à§‹à¦°à§‡ à¦¨à¦¾ à¦¡à¦¾à¦•à¦²à§‡ à¦¶à¦¾à¦¨à§à¦¤à¦¿ à¦¨à¦¾à¦‡ à¦®à¦¨à§‡ à¦¹à§Ÿ ðŸ¤¨",
      "à¦šà¦¾ à¦–à¦¾à¦¬à¦¿ à¦¨à¦¾à¦•à¦¿? â˜•",
      "à¦¤à§à¦‡ à¦¨à¦¾ à¦¡à¦¾à¦•à¦²à§‡ à¦†à¦®à¦¾à¦° à¦®à¦¨à§‡ à¦¹à§Ÿ à¦—à¦¨à§à¦¡à¦—à§‹à¦²! ðŸ¤”",
      "à¦¬à¦¸ à¦†à¦®à¦¿ à¦†à¦¸à¦›à¦¿, à¦­à¦°à¦¸à¦¾ à¦°à¦¾à¦– ðŸ› ï¸",
      "à¦¤à§‹à¦°à§‡ à¦¨à¦¾ à¦¡à¦¾à¦•à¦²à§‡ à¦¤à§‹ à¦†à¦®à¦¾à¦° à¦‡à¦¨à¦•à¦¾à¦® à¦¬à¦¨à§à¦§ à¦¹à§Ÿà§‡ à¦¯à¦¾à§Ÿ ðŸ˜‚",
      "à¦•à¦¿ à¦—à§‹, à¦†à¦¬à¦¾à¦° à¦•à¦¿à¦¸à§‡à¦° à¦šà¦¿à¦¨à§à¦¤à¦¾? ðŸ§ ",
      "à¦†à¦®à¦¾à¦°à§‡ à¦¡à¦¾à¦•à¦›à¦¿à¦¸ à¦®à¦¾à¦¨à§‡ à¦†à¦¬à¦¾à¦° à¦à¦¾à¦®à§‡à¦²à¦¾ à¦¶à§à¦°à§ ðŸ˜ˆ",
      "à¦“à¦°à§‡ à¦¬à¦¾à¦¬à¦¾, à¦†à¦°à§‡à¦•à¦¬à¦¾à¦° à¦¡à¦¾à¦•! ðŸ—£ï¸",
      "à¦†à¦®à¦¿ à¦•à¦¿ à¦œà¦¾à¦¦à§à¦•à¦°? ðŸª„",
      "à¦¡à¦¾à¦• à¦¦à¦¿à¦²à¦¿, à¦¹à¦¾à¦œà¦¿à¦° à¦¹à¦‡à¦²à¦¾à¦®! ðŸ«¡",
      "à¦à¦‡à¦¬à¦¾à¦° à¦•à¦¿ à¦¨à¦¤à§à¦¨ à¦ªà§à¦²à§à¦¯à¦¾à¦¨? ðŸ¤¨",
      "à¦¤à§à¦‡ à¦¨à¦¾ à¦¡à¦¾à¦•à¦²à§‡ à¦†à¦®à¦¿ à¦¨à¦¾à¦•à¦¿ à¦–à¦¾à¦²à¦¿ à¦¬à¦¸à§‡ à¦¥à¦¾à¦•à¦¿ ðŸ¤·",
      "à¦¬à¦¸, à¦†à¦¬à¦¾à¦°à§‹ à¦†à¦®à¦¿ à¦¹à¦¾à¦œà¦¿à¦°! ðŸ˜‡",
      "à¦à¦‡à¦¬à¦¾à¦° à¦•à¦¿à¦¸à§‡à¦° à¦œà¦¨à§à¦¯ à¦¡à¦¾à¦•à¦¸? ðŸ•µï¸",
      "à¦¤à§à¦‡ à¦¡à¦¾à¦•à¦²à§‡ à¦¤à§‹ à¦†à¦®à¦¿ à¦¦à§Œà§œà§‡ à¦†à¦¸à¦¿ ðŸƒ",
      "à¦•à¦¿ à¦¬à¦²à¦¬à¦¿? à¦†à¦—à§‡ à¦•à¦«à¦¿ à¦–à§‡à§Ÿà§‡ à¦¨à§‡à¦‡ â˜•ðŸ˜‚",
      "à¦à¦¤ à¦¡à¦¾à¦•à¦¾à¦¡à¦¾à¦•à¦¿ à¦•à¦°à¦¿à¦¸ à¦¨à¦¾, à¦—à¦²à¦¾ à¦¬à¦¸à§‡ à¦¯à¦¾à¦¬à§‡ ðŸ˜œ",
      "à¦à¦‡à¦¬à¦¾à¦° à¦•à¦¿ à¦®à¦¿à¦¶à¦¨? ðŸ§¨",
      "à¦¹à§à¦®, à¦¡à¦¾à¦•à¦²à¦¿ à¦¤à§‹ à¦¹à¦¾à¦œà¦¿à¦° à¦¹à¦‡à¦²à¦¾à¦® ðŸ’¡",
      "à¦¤à§‹à¦° à¦¡à¦¾à¦•à§‡ à¦†à¦®à¦¿ à¦•à¦–à¦¨à§‹ à¦¨à¦¾ à¦•à¦°à¦¿ à¦¨à¦¾ ðŸ˜Ž",
      "à¦¬à¦¸, à¦•à¦¿ à¦Ÿà§‡à¦¨à¦¶à¦¨? ðŸ˜°",
      "à¦¤à§à¦‡ à¦†à¦¬à¦¾à¦°! à¦•à¦‡ à¦¥à¦¾à¦•à¦¿à¦¸ à¦¸à¦¬ à¦¸à¦®à§Ÿ? ðŸ¤¯",
      "à¦à¦‡à¦¬à¦¾à¦° à¦¤à§‹ à¦¡à¦¾à¦• à¦¶à§à¦¨à§‡à¦‡ à¦­à§Ÿ à¦ªà¦¾à¦‡à¦›à¦¿ ðŸ˜±",
      "à¦¤à§à¦‡ à¦¡à¦¾à¦•à¦¸ à¦®à¦¾à¦¨à§‡ à¦†à¦¬à¦¾à¦° à¦¨à¦¾à¦Ÿà¦• à¦¶à§à¦°à§ ðŸŽ­",
      "à¦†à¦®à¦¾à¦•à§‡ à¦¨à¦¾ à¦¡à¦¾à¦•à¦²à§‡ à¦•à¦¿ à¦¤à§‹à¦° à¦šà¦²à§‡ à¦¨à¦¾? ðŸ˜‚",
      "à¦¬à¦¸, à¦à¦•à¦¦à¦¿à¦¨ à¦›à§à¦Ÿà¦¿ à¦¦à¦¿à¦¬à¦¿ à¦¨à¦¾ à¦¨à¦¾à¦•à¦¿? ðŸ–ï¸",
      "à¦¤à§à¦‡ à¦¡à¦¾à¦•à¦²à¦¿ à¦®à¦¾à¦¨à§‡à¦‡ à¦¹à¦¾à¦¸à¦¿ à¦ªà¦¾à§Ÿ ðŸ¤£",
      "à¦à¦‡à¦¬à¦¾à¦° à¦•à¦¿à¦¸à§‡à¦° à¦•à¦¾à¦¹à¦¿à¦¨à§€? ðŸ“–",
      "à¦•à¦¿ à¦…à¦¬à¦¸à§à¦¥à¦¾? à¦šà¦¾à¦•à¦°à¦¿ à¦¬à¦¾à¦¦ à¦¦à¦¿à¦¬à¦¿ à¦¨à¦¾à¦•à¦¿? ðŸ’¼",
      "à¦¤à§à¦‡ à¦¡à¦¾à¦•à§‡ à¦¨à¦¾ à¦‰à¦¤à§à¦¤à¦° à¦¦à¦¿à¦²à§‡ à¦–à¦¾à¦°à¦¾à¦ª à¦²à¦¾à¦—à§‡ ðŸ˜”",
      "à¦à¦‡à¦¬à¦¾à¦° à¦¡à¦¾à¦• à¦¶à§à¦¨à§‡à¦‡ à¦šà¦¾à¦°à§à¦œà¦¾à¦°à§‡ à¦²à¦¾à¦—à¦¾à¦‡à¦²à¦¾à¦® ðŸ“±âš¡",
      "à¦¡à¦¾à¦•à¦¸ à¦¤à§‹, à¦¹à¦¾à¦œà¦¿à¦° à¦¹à¦‡à¦²à¦¾à¦® à¦­à¦¾à¦‡ ðŸ¤",
      "à¦¤à§à¦‡ à¦¨à¦¾ à¦¡à¦¾à¦•à¦²à§‡ à¦¤à§‹ à¦†à¦®à¦¿ à¦˜à§à¦®à¦¾à¦‡à¦¤à¦¾à¦® ðŸ˜´",
      "à¦†à¦®à¦¾à¦°à¦“ à¦à¦•à¦Ÿà§ à¦˜à§à¦® à¦ªà¦¾à§Ÿ, à¦¡à¦¾à¦•à¦¿à¦¸ à¦¨à¦¾ à¦ªà§à¦²à¦¿à¦œ ðŸ˜ª",
      "à¦à¦‡à¦¬à¦¾à¦° à¦¡à¦¾à¦• à¦¶à§à¦¨à§‡ à¦®à¦¨à§‡ à¦¹à§Ÿ à¦­à¦°à¦¾à¦¡à§à¦¬à¦¿ à¦¹à¦‡à¦¬ ðŸ˜­",
      "à¦¤à§à¦‡ à¦¡à¦¾à¦•à¦²à§‡ à¦¤à§‹ à¦¸à¦¬ à¦­à§à¦²à§‡ à¦¯à¦¾à¦‡ ðŸ˜",
      "à¦¡à¦¾à¦• à¦¶à§à¦¨à§‡à¦‡ à¦¬à§à¦• à¦§à§œà¦«à§œ à¦•à¦°à§‡ â¤ï¸",
      "à¦à¦‡à¦¬à¦¾à¦° à¦•à¦¿ à¦ªà§à¦°à§‡à¦®à§‡à¦° à¦•à¦¾à¦¹à¦¿à¦¨à§€ à¦¶à§à¦¨à¦¾à¦¬à¦¿? ðŸ’˜",
      "à¦¬à¦¸, à¦à¦•à¦Ÿà§ à¦¶à¦¾à¦¨à§à¦¤à¦¿ à¦šà¦¾à¦‡, à¦¡à¦¾à¦•à¦¾ à¦¬à¦¨à§à¦§ à¦•à¦°à¦¿à¦¸ ðŸ˜¤",
      "à¦¤à§à¦‡ à¦¡à¦¾à¦•à¦¸ à¦®à¦¾à¦¨à§‡ à¦†à¦¬à¦¾à¦° à¦®à¦œà¦¾ à¦¶à§à¦°à§! ðŸŽ‰",
      "à¦†à¦œà¦•à§‡à¦“ à¦†à¦®à¦¿ à¦¹à¦¾à¦œà¦¿à¦°! ðŸŒŸ",
      "à¦¤à§à¦‡ à¦¡à¦¾à¦•à¦¸, à¦†à¦®à¦¿ à¦¤à§‹ à¦†à¦¸à¦¬à¦‡ ðŸ˜Œ"
    ];

    const fetchApiResponse = async (text) => {
      try {
        const kl = await axios.get('https://raw.githubusercontent.com/MOHAMMAD-NAYAN-07/Nayan/main/api.json');
        const apiUrl = kl.data.api2;
        const response = await axios.get(`${apiUrl}/sim?type=ask&ask=${encodeURIComponent(text)}`);
        if (response.data.status === "200") {
          return response.data.data.msg;
        }
        return "âš ï¸ Unexpected response from the API.";
      } catch (error) {
        console.error("Error fetching data from API:", error);
        return "âš ï¸ Unable to fetch data from the API.";
      }
    };

    if (text.toLowerCase() === "off") {
      isReplyEnabled = false;
      await api.sendMessage(chatId, "âœ… Reply functionality is now turned off.");
      return;
    }

    if (text.toLowerCase() === "on") {
      isReplyEnabled = true;
      await api.sendMessage(chatId, "âœ… Reply functionality is now turned on.");
      return;
    }

    if (text) {
      const apiResponse = await fetchApiResponse(text);
      lastReplies[chatId] = apiResponse;
      await api.sendMessage(chatId, apiResponse, {reply_to_message_id: event.msg.message_id});
    } else {
      const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];
      const firstName = event.message.from?.first_name || "Undefined";
      const lastName = event.message.from?.last_name || "Undefined";
      await api.sendMessage(chatId, `${firstName} ${lastName}, ${randomGreeting}`, {reply_to_message_id: event.msg.message_id});
    }

    api.on("message", async (msg) => {
      if (msg.reply_to_message && msg.reply_to_message.from.id === botId) {
        const chatId = msg.chat.id;
        const userReply = msg.text;

        if (isReplyEnabled && lastReplies[chatId]) {
          const apiResponse = await fetchApiResponse(userReply);
          await api.sendMessage(chatId, apiResponse);
        }
      }
    });
  },
};
